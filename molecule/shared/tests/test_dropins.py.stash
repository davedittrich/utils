# -*- coding: utf-8 -*-

import os
import testinfra  # noqa
import unittest

from molecule.shared import (
    ansible_vars,
    get_homedir,
    host,
    skip_unless_role,
    testinfra_hosts,
)


class Test_Dropins(unittest.TestCase):
    """Tests for user-level dropin directories."""

    def setUp(self):
        self.testinfra_hosts = testinfra_hosts
        self.host = host

    def tearDown(self):
        pass

    @skip_unless_role('davedittrich.utils.dropins')
    def test_dropin_directories(self):
        self.assertTrue('dropin_users' in ansible_vars)
        self.assertTrue('dropin_files' in ansible_vars)
        for user in ansible_vars['dropin_users']:
            for dropin_file in ansible_vars['dropin_files']:
                dropin_dir_path = os.path.join(
                    get_homedir(user),
                    f'{dropin_file}.d'
                )
                dropin_dir = self.host.file(dropin_dir_path)
                self.assertTrue(dropin_dir.exists)
                self.assertTrue(dropin_dir.is_directory)
                self.assertTrue(len(dropin_dir.listdir()) > 0)
                self.assertEqual(dropin_dir.user, user)
                self.assertEqual(dropin_dir.group, user)


# vim: set fileencoding=utf-8 ts=4 sw=4 tw=0 et :
